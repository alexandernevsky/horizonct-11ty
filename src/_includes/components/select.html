{# 
  Select/Dropdown Component based on shadcn/ui with Alpine.js
  Usage:
    {% set selectId = "language-select" %}
    {% set selectOptions = [{"value": "en", "label": "English"}, {"value": "ru", "label": "Русский"}] %}
    {% set selectValue = "en" %}
    {% include "components/select.html" %}
#}
{% set selectId = selectId | default("select") %}
{% set selectOptions = selectOptions | default([]) %}
{% set selectValue = selectValue | default("") %}
{% set selectPlaceholder = selectPlaceholder | default("Select...") %}
{% set selectClass = selectClass | default("") %}
{% set selectDisabled = selectDisabled | default(false) %}

{% set selectedOption = selectOptions | selectattr("value", "equalto", selectValue) | first %}
{% if not selectedOption %}
  {% set selectedOption = {"value": "", "label": selectPlaceholder} %}
{% endif %}

<div class="relative" x-data="{ 
  open: false, 
  currentValue: '{{ selectValue }}'
}" @click.away="open = false">
  <button
    type="button"
    @click="open = !open"
    {% if selectDisabled %}disabled{% endif %}
    class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 {{ selectClass }}"
    aria-haspopup="listbox"
    :aria-expanded="open"
  >
    <span>
      {% if selectedOption.value == selectValue %}
        {{ selectedOption.label }}
      {% else %}
        {{ selectPlaceholder }}
      {% endif %}
    </span>
    <span class="h-4 w-4 opacity-50 transition-transform duration-200" :class="{ 'rotate-180': open }">
      {% icon "chevron-down", { size: 16, class: "h-4 w-4" } %}
    </span>
  </button>
  
  <ul
    x-show="open"
    x-transition:enter="transition ease-out duration-100"
    x-transition:enter-start="opacity-0 scale-95"
    x-transition:enter-end="opacity-100 scale-100"
    x-transition:leave="transition ease-in duration-75"
    x-transition:leave-start="opacity-100 scale-100"
    x-transition:leave-end="opacity-0 scale-95"
    class="absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border bg-popover p-1 text-popover-foreground shadow-md"
    role="listbox"
    style="display: none;"
  >
    {% for opt in selectOptions %}
    <li
      role="option"
      @click="currentValue = '{{ opt.value }}'; open = false; {% if selectOnChange %}{{ selectOnChange }}{% endif %} window.location.href = '{{ opt.value }}';"
      class="relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 {% if opt.value == selectValue %}bg-accent text-accent-foreground{% endif %}"
    >
      <span>{{ opt.label }}</span>
      {% if opt.value == selectValue %}
      <span class="ml-auto h-4 w-4">
        {% icon "check", { size: 16, class: "h-4 w-4" } %}
      </span>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
</div>

